{"ast":null,"code":"// TODO: Import API service for BOMs, products, components\nexport default {\n  name: 'BomForm',\n  data() {\n    return {\n      isEditMode: false,\n      isViewMode: false,\n      bomForm: {\n        product_id: null,\n        bom_version: '',\n        bom_status: 1,\n        bom_remark: '',\n        details: []\n      }\n      // TODO: rules for validation\n    };\n  },\n  created() {\n    const bomId = this.$route.params.id;\n    this.isViewMode = this.$route.query.view === 'true';\n    if (this.$route.name === 'CreateBOM') {\n      this.isEditMode = false;\n      // For new BOM, viewMode doesn't make sense, ensure it's editable.\n      this.isViewMode = false;\n      this.addDetailItem();\n    } else if (this.$route.name === 'EditBOM' && bomId) {\n      this.isEditMode = true; // isViewMode is already set from query param\n      this.fetchBomDetails(bomId);\n      console.log(`BomForm loaded for ${this.isViewMode ? 'viewing' : 'editing'} BOM ID:`, bomId);\n    } else {\n      console.error(\"BomForm loaded with unexpected route state:\", this.$route.name, this.$route.params);\n      // Potentially redirect or show an error message to the user\n      this.$message.error('无法加载BOM表单，路由状态不正确。');\n      this.goBack(); // Go back to list if state is invalid\n    }\n  },\n  methods: {\n    fetchBomDetails(bomId) {\n      console.log('Fetch BOM details for:', bomId);\n      // TODO: Replace with actual API call\n      // Simulating API call with example data based on isEditMode/isViewMode\n      this.bomForm = {\n        bom_id: bomId,\n        product_id: '1',\n        bom_version: 'V1.0',\n        bom_status: 1,\n        bom_remark: this.isViewMode ? '查看模式BOM备注' : '编辑模式BOM备注',\n        details: [{\n          bom_detail_id: 1,\n          component_id: '1',\n          quantity: 2,\n          bom_detail_remark: '主要部件'\n        }, {\n          bom_detail_id: 2,\n          component_id: '2',\n          quantity: 5,\n          bom_detail_remark: '辅助材料'\n        }]\n      };\n    },\n    addDetailItem() {\n      if (this.isViewMode) return; // Don't add items in view mode\n      this.bomForm.details.push({\n        component_id: null,\n        quantity: 1,\n        bom_detail_remark: ''\n      });\n    },\n    removeDetailItem(index) {\n      if (this.isViewMode) return; // Don't remove items in view mode\n      this.bomForm.details.splice(index, 1);\n    },\n    submitForm() {\n      if (this.isViewMode) return; // Don't submit in view mode\n      this.$refs.bomFormRef.validate(valid => {\n        if (valid) {\n          console.log('Submitting BOM:', this.bomForm);\n          // TODO: Call API to save/update BOM (differentiate create vs update by bomForm.bom_id or isEditMode)\n          this.$message.success('BOM保存成功!');\n          this.goBack();\n        } else {\n          this.$message.error('请检查表单输入!');\n          return false;\n        }\n      });\n    },\n    goBack() {\n      this.$router.push({\n        name: 'BOM'\n      }); // Route name for BomList is 'BOM'\n    }\n  }\n};","map":{"version":3,"names":["name","data","isEditMode","isViewMode","bomForm","product_id","bom_version","bom_status","bom_remark","details","created","bomId","$route","params","id","query","view","addDetailItem","fetchBomDetails","console","log","error","$message","goBack","methods","bom_id","bom_detail_id","component_id","quantity","bom_detail_remark","push","removeDetailItem","index","splice","submitForm","$refs","bomFormRef","validate","valid","success","$router"],"sources":["src/views/bom/BomForm.vue"],"sourcesContent":["<template>\n  <div class=\"bom-form-container\">\n    <h2>{{ isEditMode ? '编辑BOM' : (isViewMode ? '查看BOM' : '新增BOM') }}</h2>\n    <el-form :model=\"bomForm\" ref=\"bomFormRef\" label-width=\"120px\" :disabled=\"isViewMode\">\n      <el-form-item label=\"成品\" prop=\"product_id\">\n        <!-- TODO: Use a searchable select for products -->\n        <el-select v-model=\"bomForm.product_id\" placeholder=\"请选择成品\">\n          <el-option label=\"示例产品A (P001)\" value=\"1\"></el-option>\n          <el-option label=\"示例产品B (P002)\" value=\"2\"></el-option>\n        </el-select>\n      </el-form-item>\n      <el-form-item label=\"BOM版本\" prop=\"bom_version\">\n        <el-input v-model=\"bomForm.bom_version\" placeholder=\"例如：V1.0\"></el-input>\n      </el-form-item>\n      <el-form-item label=\"状态\" prop=\"bom_status\">\n        <el-switch v-model=\"bomForm.bom_status\" :active-value=\"1\" :inactive-value=\"0\" active-text=\"启用\" inactive-text=\"禁用\"></el-switch>\n      </el-form-item>\n      <el-form-item label=\"备注\" prop=\"bom_remark\">\n        <el-input type=\"textarea\" v-model=\"bomForm.bom_remark\"></el-input>\n      </el-form-item>\n\n      <h3>BOM明细</h3>\n      <el-table :data=\"bomForm.details\" border style=\"margin-bottom: 20px;\">\n        <el-table-column label=\"配件编码\">\n          <template slot-scope=\"scope\">\n            <!-- TODO: Searchable select for components -->\n            <el-select v-model=\"scope.row.component_id\" placeholder=\"选择配件\" :disabled=\"isViewMode\">\n               <el-option label=\"示例配件X (C001)\" value=\"1\"></el-option>\n               <el-option label=\"示例配件Y (C002)\" value=\"2\"></el-option>\n            </el-select>\n          </template>\n        </el-table-column>\n        <el-table-column label=\"用量\">\n          <template slot-scope=\"scope\">\n            <el-input-number v-model=\"scope.row.quantity\" :min=\"0.001\" :precision=\"3\" :disabled=\"isViewMode\"></el-input-number>\n          </template>\n        </el-table-column>\n        <el-table-column label=\"备注\">\n          <template slot-scope=\"scope\">\n            <el-input v-model=\"scope.row.bom_detail_remark\" :disabled=\"isViewMode\"></el-input>\n          </template>\n        </el-table-column>\n        <el-table-column label=\"操作\" v-if=\"!isViewMode\">\n          <template slot-scope=\"scope\">\n            <el-button size=\"mini\" type=\"danger\" @click=\"removeDetailItem(scope.$index)\">移除</el-button>\n          </template>\n        </el-table-column>\n      </el-table>\n      <el-button type=\"primary\" @click=\"addDetailItem\" v-if=\"!isViewMode\">添加明细项</el-button>\n\n      <el-form-item style=\"margin-top: 20px;\" v-if=\"!isViewMode\">\n        <el-button type=\"primary\" @click=\"submitForm\">保存</el-button>\n        <el-button @click=\"goBack\">取消</el-button>\n      </el-form-item>\n      <el-form-item style=\"margin-top: 20px;\" v-if=\"isViewMode\">\n        <el-button @click=\"goBack\">返回</el-button>\n      </el-form-item>\n    </el-form>\n  </div>\n</template>\n\n<script>\n// TODO: Import API service for BOMs, products, components\nexport default {\n  name: 'BomForm',\n  data() {\n    return {\n      isEditMode: false,\n      isViewMode: false,\n      bomForm: {\n        product_id: null,\n        bom_version: '',\n        bom_status: 1,\n        bom_remark: '',\n        details: []\n      },\n      // TODO: rules for validation\n    };\n  },\n  created() {\n    const bomId = this.$route.params.id;\n    this.isViewMode = this.$route.query.view === 'true';\n\n    if (this.$route.name === 'CreateBOM') {\n      this.isEditMode = false;\n      // For new BOM, viewMode doesn't make sense, ensure it's editable.\n      this.isViewMode = false; \n      this.addDetailItem(); \n    } else if (this.$route.name === 'EditBOM' && bomId) {\n      this.isEditMode = true; // isViewMode is already set from query param\n      this.fetchBomDetails(bomId);\n      console.log(`BomForm loaded for ${this.isViewMode ? 'viewing' : 'editing'} BOM ID:`, bomId);\n    } else {\n      console.error(\"BomForm loaded with unexpected route state:\", this.$route.name, this.$route.params);\n      // Potentially redirect or show an error message to the user\n      this.$message.error('无法加载BOM表单，路由状态不正确。');\n      this.goBack(); // Go back to list if state is invalid\n    }\n  },\n  methods: {\n    fetchBomDetails(bomId) {\n      console.log('Fetch BOM details for:', bomId);\n      // TODO: Replace with actual API call\n      // Simulating API call with example data based on isEditMode/isViewMode\n      this.bomForm = {\n        bom_id: bomId,\n        product_id: '1', \n        bom_version: 'V1.0',\n        bom_status: 1,\n        bom_remark: this.isViewMode ? '查看模式BOM备注' : '编辑模式BOM备注',\n        details: [\n          { bom_detail_id: 1, component_id: '1', quantity: 2, bom_detail_remark: '主要部件' },\n          { bom_detail_id: 2, component_id: '2', quantity: 5, bom_detail_remark: '辅助材料' },\n        ]\n      };\n    },\n    addDetailItem() {\n      if (this.isViewMode) return; // Don't add items in view mode\n      this.bomForm.details.push({\n        component_id: null,\n        quantity: 1,\n        bom_detail_remark: ''\n      });\n    },\n    removeDetailItem(index) {\n      if (this.isViewMode) return; // Don't remove items in view mode\n      this.bomForm.details.splice(index, 1);\n    },\n    submitForm() {\n      if (this.isViewMode) return; // Don't submit in view mode\n      this.$refs.bomFormRef.validate(valid => {\n        if (valid) {\n          console.log('Submitting BOM:', this.bomForm);\n          // TODO: Call API to save/update BOM (differentiate create vs update by bomForm.bom_id or isEditMode)\n          this.$message.success('BOM保存成功!');\n          this.goBack();\n        } else {\n          this.$message.error('请检查表单输入!');\n          return false;\n        }\n      });\n    },\n    goBack() {\n      this.$router.push({ name: 'BOM' }); // Route name for BomList is 'BOM'\n    }\n  }\n};\n</script>\n\n<style scoped>\n.bom-form-container {\n  padding: 20px;\n}\n</style> "],"mappings":"AA8DA;AACA;EACAA,IAAA;EACAC,KAAA;IACA;MACAC,UAAA;MACAC,UAAA;MACAC,OAAA;QACAC,UAAA;QACAC,WAAA;QACAC,UAAA;QACAC,UAAA;QACAC,OAAA;MACA;MACA;IACA;EACA;EACAC,QAAA;IACA,MAAAC,KAAA,QAAAC,MAAA,CAAAC,MAAA,CAAAC,EAAA;IACA,KAAAX,UAAA,QAAAS,MAAA,CAAAG,KAAA,CAAAC,IAAA;IAEA,SAAAJ,MAAA,CAAAZ,IAAA;MACA,KAAAE,UAAA;MACA;MACA,KAAAC,UAAA;MACA,KAAAc,aAAA;IACA,gBAAAL,MAAA,CAAAZ,IAAA,kBAAAW,KAAA;MACA,KAAAT,UAAA;MACA,KAAAgB,eAAA,CAAAP,KAAA;MACAQ,OAAA,CAAAC,GAAA,4BAAAjB,UAAA,oCAAAQ,KAAA;IACA;MACAQ,OAAA,CAAAE,KAAA,qDAAAT,MAAA,CAAAZ,IAAA,OAAAY,MAAA,CAAAC,MAAA;MACA;MACA,KAAAS,QAAA,CAAAD,KAAA;MACA,KAAAE,MAAA;IACA;EACA;EACAC,OAAA;IACAN,gBAAAP,KAAA;MACAQ,OAAA,CAAAC,GAAA,2BAAAT,KAAA;MACA;MACA;MACA,KAAAP,OAAA;QACAqB,MAAA,EAAAd,KAAA;QACAN,UAAA;QACAC,WAAA;QACAC,UAAA;QACAC,UAAA,OAAAL,UAAA;QACAM,OAAA,GACA;UAAAiB,aAAA;UAAAC,YAAA;UAAAC,QAAA;UAAAC,iBAAA;QAAA,GACA;UAAAH,aAAA;UAAAC,YAAA;UAAAC,QAAA;UAAAC,iBAAA;QAAA;MAEA;IACA;IACAZ,cAAA;MACA,SAAAd,UAAA;MACA,KAAAC,OAAA,CAAAK,OAAA,CAAAqB,IAAA;QACAH,YAAA;QACAC,QAAA;QACAC,iBAAA;MACA;IACA;IACAE,iBAAAC,KAAA;MACA,SAAA7B,UAAA;MACA,KAAAC,OAAA,CAAAK,OAAA,CAAAwB,MAAA,CAAAD,KAAA;IACA;IACAE,WAAA;MACA,SAAA/B,UAAA;MACA,KAAAgC,KAAA,CAAAC,UAAA,CAAAC,QAAA,CAAAC,KAAA;QACA,IAAAA,KAAA;UACAnB,OAAA,CAAAC,GAAA,yBAAAhB,OAAA;UACA;UACA,KAAAkB,QAAA,CAAAiB,OAAA;UACA,KAAAhB,MAAA;QACA;UACA,KAAAD,QAAA,CAAAD,KAAA;UACA;QACA;MACA;IACA;IACAE,OAAA;MACA,KAAAiB,OAAA,CAAAV,IAAA;QAAA9B,IAAA;MAAA;IACA;EACA;AACA","ignoreList":[]},"metadata":{},"sourceType":"module","externalDependencies":[]}