{"ast":null,"code":"import Vue from 'vue';\nimport Vuex from 'vuex';\nimport axios from 'axios';\nVue.use(Vuex);\nexport default new Vuex.Store({\n  state: {\n    token: localStorage.getItem('token') || '',\n    user: JSON.parse(localStorage.getItem('user')) || null,\n    loading: false\n  },\n  getters: {\n    isAuthenticated: state => !!state.token,\n    currentUser: state => state.user\n  },\n  mutations: {\n    SET_TOKEN(state, token) {\n      state.token = token;\n    },\n    SET_USER(state, user) {\n      state.user = user;\n    },\n    SET_LOADING(state, loading) {\n      state.loading = loading;\n    },\n    CLEAR_AUTH(state) {\n      state.token = '';\n      state.user = null;\n    }\n  },\n  actions: {\n    // 登录\n    async login({\n      commit\n    }, credentials) {\n      commit('SET_LOADING', true);\n      try {\n        const response = await axios.post('/auth/login', credentials);\n        const {\n          token,\n          user\n        } = response.data;\n        if (!token || !user) {\n          console.error('Failed to destructure token or user from response.data', response.data);\n          throw new Error('从后端响应中未能正确获取token或用户信息');\n        }\n        localStorage.setItem('token', token);\n        localStorage.setItem('user', JSON.stringify(user));\n        commit('SET_TOKEN', token);\n        commit('SET_USER', user);\n        return response;\n      } finally {\n        commit('SET_LOADING', false);\n      }\n    },\n    // 登出\n    logout({\n      commit\n    }) {\n      localStorage.removeItem('token');\n      localStorage.removeItem('user');\n      commit('CLEAR_AUTH');\n    },\n    // 获取用户信息\n    async fetchUserInfo({\n      commit\n    }) {\n      commit('SET_LOADING', true);\n      try {\n        const response = await axios.get('/auth/me');\n        const user = response.data.user;\n        if (!user || Object.keys(user).length === 0) {\n          console.error('Failed to get user info from response.data.user', response.data);\n          throw new Error('未能从后端响应中获取有效的用户信息');\n        }\n        localStorage.setItem('user', JSON.stringify(user));\n        commit('SET_USER', user);\n        return user;\n      } finally {\n        commit('SET_LOADING', false);\n      }\n    }\n  }\n});","map":{"version":3,"names":["Vue","Vuex","axios","use","Store","state","token","localStorage","getItem","user","JSON","parse","loading","getters","isAuthenticated","currentUser","mutations","SET_TOKEN","SET_USER","SET_LOADING","CLEAR_AUTH","actions","login","commit","credentials","response","post","data","console","error","Error","setItem","stringify","logout","removeItem","fetchUserInfo","get","Object","keys","length"],"sources":["/Users/gongqian/Downloads/xianglong-erp/frontend/src/store/index.js"],"sourcesContent":["import Vue from 'vue'\nimport Vuex from 'vuex'\nimport axios from 'axios'\n\nVue.use(Vuex)\n\nexport default new Vuex.Store({\n  state: {\n    token: localStorage.getItem('token') || '',\n    user: JSON.parse(localStorage.getItem('user')) || null,\n    loading: false\n  },\n  getters: {\n    isAuthenticated: state => !!state.token,\n    currentUser: state => state.user\n  },\n  mutations: {\n    SET_TOKEN(state, token) {\n      state.token = token\n    },\n    SET_USER(state, user) {\n      state.user = user\n    },\n    SET_LOADING(state, loading) {\n      state.loading = loading\n    },\n    CLEAR_AUTH(state) {\n      state.token = ''\n      state.user = null\n    }\n  },\n  actions: {\n    // 登录\n    async login({ commit }, credentials) {\n      commit('SET_LOADING', true)\n      try {\n        const response = await axios.post('/auth/login', credentials)\n        const { token, user } = response.data\n        \n        if (!token || !user) {\n            console.error('Failed to destructure token or user from response.data', response.data);\n            throw new Error('从后端响应中未能正确获取token或用户信息');\n        }\n\n        localStorage.setItem('token', token)\n        localStorage.setItem('user', JSON.stringify(user))\n        \n        commit('SET_TOKEN', token)\n        commit('SET_USER', user)\n        \n        return response\n      } finally {\n        commit('SET_LOADING', false)\n      }\n    },\n    \n    // 登出\n    logout({ commit }) {\n      localStorage.removeItem('token')\n      localStorage.removeItem('user')\n      commit('CLEAR_AUTH')\n    },\n    \n    // 获取用户信息\n    async fetchUserInfo({ commit }) {\n      commit('SET_LOADING', true)\n      try {\n        const response = await axios.get('/auth/me')\n        const user = response.data.user\n        \n        if (!user || Object.keys(user).length === 0) {\n            console.error('Failed to get user info from response.data.user', response.data);\n            throw new Error('未能从后端响应中获取有效的用户信息');\n        }\n\n        localStorage.setItem('user', JSON.stringify(user))\n        commit('SET_USER', user)\n        \n        return user\n      } finally {\n        commit('SET_LOADING', false)\n      }\n    }\n  }\n})\n"],"mappings":"AAAA,OAAOA,GAAG,MAAM,KAAK;AACrB,OAAOC,IAAI,MAAM,MAAM;AACvB,OAAOC,KAAK,MAAM,OAAO;AAEzBF,GAAG,CAACG,GAAG,CAACF,IAAI,CAAC;AAEb,eAAe,IAAIA,IAAI,CAACG,KAAK,CAAC;EAC5BC,KAAK,EAAE;IACLC,KAAK,EAAEC,YAAY,CAACC,OAAO,CAAC,OAAO,CAAC,IAAI,EAAE;IAC1CC,IAAI,EAAEC,IAAI,CAACC,KAAK,CAACJ,YAAY,CAACC,OAAO,CAAC,MAAM,CAAC,CAAC,IAAI,IAAI;IACtDI,OAAO,EAAE;EACX,CAAC;EACDC,OAAO,EAAE;IACPC,eAAe,EAAET,KAAK,IAAI,CAAC,CAACA,KAAK,CAACC,KAAK;IACvCS,WAAW,EAAEV,KAAK,IAAIA,KAAK,CAACI;EAC9B,CAAC;EACDO,SAAS,EAAE;IACTC,SAASA,CAACZ,KAAK,EAAEC,KAAK,EAAE;MACtBD,KAAK,CAACC,KAAK,GAAGA,KAAK;IACrB,CAAC;IACDY,QAAQA,CAACb,KAAK,EAAEI,IAAI,EAAE;MACpBJ,KAAK,CAACI,IAAI,GAAGA,IAAI;IACnB,CAAC;IACDU,WAAWA,CAACd,KAAK,EAAEO,OAAO,EAAE;MAC1BP,KAAK,CAACO,OAAO,GAAGA,OAAO;IACzB,CAAC;IACDQ,UAAUA,CAACf,KAAK,EAAE;MAChBA,KAAK,CAACC,KAAK,GAAG,EAAE;MAChBD,KAAK,CAACI,IAAI,GAAG,IAAI;IACnB;EACF,CAAC;EACDY,OAAO,EAAE;IACP;IACA,MAAMC,KAAKA,CAAC;MAAEC;IAAO,CAAC,EAAEC,WAAW,EAAE;MACnCD,MAAM,CAAC,aAAa,EAAE,IAAI,CAAC;MAC3B,IAAI;QACF,MAAME,QAAQ,GAAG,MAAMvB,KAAK,CAACwB,IAAI,CAAC,aAAa,EAAEF,WAAW,CAAC;QAC7D,MAAM;UAAElB,KAAK;UAAEG;QAAK,CAAC,GAAGgB,QAAQ,CAACE,IAAI;QAErC,IAAI,CAACrB,KAAK,IAAI,CAACG,IAAI,EAAE;UACjBmB,OAAO,CAACC,KAAK,CAAC,wDAAwD,EAAEJ,QAAQ,CAACE,IAAI,CAAC;UACtF,MAAM,IAAIG,KAAK,CAAC,wBAAwB,CAAC;QAC7C;QAEAvB,YAAY,CAACwB,OAAO,CAAC,OAAO,EAAEzB,KAAK,CAAC;QACpCC,YAAY,CAACwB,OAAO,CAAC,MAAM,EAAErB,IAAI,CAACsB,SAAS,CAACvB,IAAI,CAAC,CAAC;QAElDc,MAAM,CAAC,WAAW,EAAEjB,KAAK,CAAC;QAC1BiB,MAAM,CAAC,UAAU,EAAEd,IAAI,CAAC;QAExB,OAAOgB,QAAQ;MACjB,CAAC,SAAS;QACRF,MAAM,CAAC,aAAa,EAAE,KAAK,CAAC;MAC9B;IACF,CAAC;IAED;IACAU,MAAMA,CAAC;MAAEV;IAAO,CAAC,EAAE;MACjBhB,YAAY,CAAC2B,UAAU,CAAC,OAAO,CAAC;MAChC3B,YAAY,CAAC2B,UAAU,CAAC,MAAM,CAAC;MAC/BX,MAAM,CAAC,YAAY,CAAC;IACtB,CAAC;IAED;IACA,MAAMY,aAAaA,CAAC;MAAEZ;IAAO,CAAC,EAAE;MAC9BA,MAAM,CAAC,aAAa,EAAE,IAAI,CAAC;MAC3B,IAAI;QACF,MAAME,QAAQ,GAAG,MAAMvB,KAAK,CAACkC,GAAG,CAAC,UAAU,CAAC;QAC5C,MAAM3B,IAAI,GAAGgB,QAAQ,CAACE,IAAI,CAAClB,IAAI;QAE/B,IAAI,CAACA,IAAI,IAAI4B,MAAM,CAACC,IAAI,CAAC7B,IAAI,CAAC,CAAC8B,MAAM,KAAK,CAAC,EAAE;UACzCX,OAAO,CAACC,KAAK,CAAC,iDAAiD,EAAEJ,QAAQ,CAACE,IAAI,CAAC;UAC/E,MAAM,IAAIG,KAAK,CAAC,mBAAmB,CAAC;QACxC;QAEAvB,YAAY,CAACwB,OAAO,CAAC,MAAM,EAAErB,IAAI,CAACsB,SAAS,CAACvB,IAAI,CAAC,CAAC;QAClDc,MAAM,CAAC,UAAU,EAAEd,IAAI,CAAC;QAExB,OAAOA,IAAI;MACb,CAAC,SAAS;QACRc,MAAM,CAAC,aAAa,EAAE,KAAK,CAAC;MAC9B;IACF;EACF;AACF,CAAC,CAAC","ignoreList":[]},"metadata":{},"sourceType":"module","externalDependencies":[]}